<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FSM HAR system: common/src/fsm_har_system.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FSM HAR system
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('fsm__har__system_8c_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">fsm_har_system.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="fsm__har__system_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160; </div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">/* Includes ------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">/* Standard C includes */</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160; </div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">/* Project includes */</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="fsm__har__system_8h.html">fsm_har_system.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;knn_har_model.h&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="port__har__sensor_8h.html">port_har_sensor.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160; </div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">/* Private functions ---------------------------------------------------------*/</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno"><a class="line" href="fsm__har__system_8c.html#a41512ba33da38d2c436e02d316a31d56">   33</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="fsm__har__system_8c.html#a41512ba33da38d2c436e02d316a31d56">_compute_max</a>(<a class="code" href="structfsm__har__system__t.html">fsm_har_system_t</a> *p_fsm, uint8_t axis)</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;{</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    </div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;}</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00048"></a><span class="lineno"><a class="line" href="fsm__har__system_8c.html#abb44dd14551a3c3446bcaea3449e8cc4">   48</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="fsm__har__system_8c.html#abb44dd14551a3c3446bcaea3449e8cc4">_compute_min</a>(<a class="code" href="structfsm__har__system__t.html">fsm_har_system_t</a> *p_fsm, uint8_t axis)</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;{</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;}</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="fsm__har__system_8c.html#a8517aae43a8b2f990419f61aed54e625">   64</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="fsm__har__system_8c.html#a8517aae43a8b2f990419f61aed54e625">_compute_mean</a>(<a class="code" href="structfsm__har__system__t.html">fsm_har_system_t</a> *p_fsm, uint8_t axis)</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;{</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    </div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;}</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160; </div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="fsm__har__system_8c.html#adcb8898f96c3ba06de211d7f4c5d77f9">   77</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="fsm__har__system_8c.html#adcb8898f96c3ba06de211d7f4c5d77f9">_compare_doubles</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *a, <span class="keyword">const</span> <span class="keywordtype">void</span> *b)</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;{</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordtype">double</span> arg1 = *(<span class="keyword">const</span> <span class="keywordtype">double</span> *)a;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="keywordtype">double</span> arg2 = *(<span class="keyword">const</span> <span class="keywordtype">double</span> *)b;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160; </div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keywordflow">if</span> (arg1 &lt; arg2)</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordflow">if</span> (arg1 &gt; arg2)</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;}</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00096"></a><span class="lineno"><a class="line" href="fsm__har__system_8c.html#afd93b3801ccae1618d88087067483723">   96</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="fsm__har__system_8c.html#afd93b3801ccae1618d88087067483723">_compute_median</a>(<a class="code" href="structfsm__har__system__t.html">fsm_har_system_t</a> *p_fsm, uint8_t axis)</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;{</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="keywordtype">double</span> axis_cpy[<a class="code" href="fsm__har__system_8h.html#a128deea257b0bb81860350d5ac9e21a4">WINDOW_SIZE_SAMPLES</a>];</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">// Copy the row to a local array to sort it</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="keywordflow">for</span> (uint32_t r = 0; r &lt; <a class="code" href="fsm__har__system_8h.html#a128deea257b0bb81860350d5ac9e21a4">WINDOW_SIZE_SAMPLES</a>; r++)</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    {</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        axis_cpy[r] = p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a21a322855d075136288f7cd9da871e31">acc_block</a>[r][axis];</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    }</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    qsort(axis_cpy, <a class="code" href="fsm__har__system_8h.html#a128deea257b0bb81860350d5ac9e21a4">WINDOW_SIZE_SAMPLES</a>, <span class="keyword">sizeof</span>(axis_cpy[0]), <a class="code" href="fsm__har__system_8c.html#adcb8898f96c3ba06de211d7f4c5d77f9">_compare_doubles</a>); <span class="comment">// Short axis_cpy</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordflow">return</span> axis_cpy[(uint32_t)round(<a class="code" href="fsm__har__system_8h.html#a128deea257b0bb81860350d5ac9e21a4">WINDOW_SIZE_SAMPLES</a> / 2)];                   <span class="comment">// Value in the middle</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;}</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160; </div>
<div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="fsm__har__system_8c.html#a0265ced907a4148afc083a8a5c9f911d">  121</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="fsm__har__system_8c.html#a0265ced907a4148afc083a8a5c9f911d">_compute_variance</a>(<a class="code" href="structfsm__har__system__t.html">fsm_har_system_t</a> *p_fsm, uint8_t axis)</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;{</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;}</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160; </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">/* State machine input or transition functions */</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160; </div>
<div class="line"><a name="l00135"></a><span class="lineno"><a class="line" href="fsm__har__system_8c.html#a667d4dbe675f064c7723c1b22632b31c">  135</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="fsm__har__system_8c.html#a667d4dbe675f064c7723c1b22632b31c">check_sample</a>(fsm_t *p_this)</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;{</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <a class="code" href="structfsm__har__system__t.html">fsm_har_system_t</a> *p_fsm = (<a class="code" href="structfsm__har__system__t.html">fsm_har_system_t</a> *)p_this;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="port__har__sensor_8h.html#a5f3f04c7b99934b6e9732551bf095a08">port_har_sensor_check_samples_available</a>(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#ab5f6570893aafdd1e432674bfd2bc490">p_har_sensor</a>);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;}</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160; </div>
<div class="line"><a name="l00148"></a><span class="lineno"><a class="line" href="fsm__har__system_8c.html#afb48834ffa4f8297e212b2a77374a19a">  148</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="fsm__har__system_8c.html#afb48834ffa4f8297e212b2a77374a19a">check_block_size</a>(fsm_t *p_this)</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;{</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <a class="code" href="structfsm__har__system__t.html">fsm_har_system_t</a> *p_fsm = (<a class="code" href="structfsm__har__system__t.html">fsm_har_system_t</a> *)p_this;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordflow">return</span> p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a822d55e774a1db57547ae333dac25c8d">acc_block_available</a>;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;}</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00161"></a><span class="lineno"><a class="line" href="fsm__har__system_8c.html#aefc571a9cb8a91bd5349a60893b3741e">  161</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="fsm__har__system_8c.html#aefc571a9cb8a91bd5349a60893b3741e">check_features</a>(fsm_t *p_this)</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;{</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="structfsm__har__system__t.html">fsm_har_system_t</a> *p_fsm = (<a class="code" href="structfsm__har__system__t.html">fsm_har_system_t</a> *)p_this;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordflow">return</span> p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a581a91717c2a9cfa61a828eb9b1ef7e6">features_computed</a>;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;}</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160; </div>
<div class="line"><a name="l00174"></a><span class="lineno"><a class="line" href="fsm__har__system_8c.html#a91c31f180f16c2d66ef56e62004c83bc">  174</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="fsm__har__system_8c.html#a91c31f180f16c2d66ef56e62004c83bc">check_activity</a>(fsm_t *p_this)</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;{</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keyword">static</span> uint32_t last_activity_index = 0;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <a class="code" href="structfsm__har__system__t.html">fsm_har_system_t</a> *p_fsm = (<a class="code" href="structfsm__har__system__t.html">fsm_har_system_t</a> *)p_this;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160; </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="comment">// Check if the last activity is different from the current activity</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordflow">if</span> (last_activity_index != p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a3651183c2c2549f06e324f978ded0d7c">activities_detected_index</a>)</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        last_activity_index = p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a3651183c2c2549f06e324f978ded0d7c">activities_detected_index</a>;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    }</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;}</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160; </div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">/* State machine output or action functions */</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160; </div>
<div class="line"><a name="l00195"></a><span class="lineno"><a class="line" href="fsm__har__system_8c.html#a8374b901eccab8dd49dbfbec8af58aa1">  195</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="fsm__har__system_8c.html#a8374b901eccab8dd49dbfbec8af58aa1">do_store_data</a>(fsm_t *p_this)</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;{</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <a class="code" href="structfsm__har__system__t.html">fsm_har_system_t</a> *p_fsm = (<a class="code" href="structfsm__har__system__t.html">fsm_har_system_t</a> *)p_this;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <a class="code" href="structport__har__sensor__t.html">port_har_sensor_t</a> *p_har_sensor = p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#ab5f6570893aafdd1e432674bfd2bc490">p_har_sensor</a>;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160; </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    uint32_t current_idx = p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a2b0460e474e0f883dd218bbb924bc3ba">acc_sample_index</a>;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160; </div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="comment">// Save the sample in the acceleration block</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a21a322855d075136288f7cd9da871e31">acc_block</a>[current_idx][<a class="code" href="fsm__har__system_8h.html#a753faa457a1c2937ea3fdcdb83c3ca5f">AXIS_X</a>] = p_har_sensor-&gt;<a class="code" href="structport__har__sensor__t.html#a639b166d9af3749a564c93ab565eac4e">x</a>.<a class="code" href="structanalog__acc__axis__t.html#abe01350a2e160bd569335a6735421154">axis_value</a>;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a21a322855d075136288f7cd9da871e31">acc_block</a>[current_idx][<a class="code" href="fsm__har__system_8h.html#a08f3e26d90cf66bf2840d476e5d4711f">AXIS_Y</a>] = p_har_sensor-&gt;<a class="code" href="structport__har__sensor__t.html#ae2415033b8ebe0f5dd7e1d75c46c0e15">y</a>.<a class="code" href="structanalog__acc__axis__t.html#abe01350a2e160bd569335a6735421154">axis_value</a>;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a21a322855d075136288f7cd9da871e31">acc_block</a>[current_idx][<a class="code" href="fsm__har__system_8h.html#a220ebc22eb87c8989bfd63ae3cbbe2a8">AXIS_Z</a>] = p_har_sensor-&gt;<a class="code" href="structport__har__sensor__t.html#a015bed8353758feea8a244b24ad0556d">z</a>.<a class="code" href="structanalog__acc__axis__t.html#abe01350a2e160bd569335a6735421154">axis_value</a>;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160; </div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="comment">// Increase the sample index</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a2b0460e474e0f883dd218bbb924bc3ba">acc_sample_index</a>++;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160; </div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="comment">// Disable the flag to indicate that the sample is not available</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    p_har_sensor-&gt;<a class="code" href="structport__har__sensor__t.html#ac86193107b172b0002ef3c99aea0bd83">samples_available</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160; </div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keywordflow">if</span> (p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a2b0460e474e0f883dd218bbb924bc3ba">acc_sample_index</a> &gt;= <a class="code" href="fsm__har__system_8h.html#a128deea257b0bb81860350d5ac9e21a4">WINDOW_SIZE_SAMPLES</a>)</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    {</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a2b0460e474e0f883dd218bbb924bc3ba">acc_sample_index</a> = 0;                          <span class="comment">// Restart the index</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <a class="code" href="port__har__system_8h.html#a15a88ba5bd502a7c194e3a360a2a8425">port_har_system_timer_disable</a>(&amp;p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a5a0f2f6e767a78803d679cfd4e035bda">har_system_hw</a>); <span class="comment">// Disable the timer to compute the features</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a822d55e774a1db57547ae333dac25c8d">acc_block_available</a> = <span class="keyword">true</span>;                    <span class="comment">// Enable the flag to indicate that the block is available</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    }</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    {</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        <a class="code" href="port__system_8h.html#ae3c6ff19d65f5cdeb1e1b556b0823b40">port_system_sleep</a>(); <span class="comment">// Go to sleep</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    }</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;}</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160; </div>
<div class="line"><a name="l00236"></a><span class="lineno"><a class="line" href="fsm__har__system_8c.html#a2350d41508ad4eea851ec2db1fc008e1">  236</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="fsm__har__system_8c.html#a2350d41508ad4eea851ec2db1fc008e1">do_compute_features</a>(fsm_t *p_this)</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;{</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <a class="code" href="structfsm__har__system__t.html">fsm_har_system_t</a> *p_fsm = (<a class="code" href="structfsm__har__system__t.html">fsm_har_system_t</a> *)p_this;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160; </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="comment">// Calcular el máximo, mínimo, media, mediana, y varianza para cada componente de la aceleración</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160; </div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160; </div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160; </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160; </div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160; </div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="comment">// Calcular la varianza y la desviación estándar. Para calcular la varianza es importante calcular primero la media, luego la varianza, y finalmente la desviación estándar</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    </div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160; </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160; </div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160; </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160; </div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="comment">// Calcular la amplitud. Es importante calcular la amplitud después del máximo y la media</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    </div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    </div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160; </div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160; </div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160; </div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160; </div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="comment">// Enable the flag to indicate that the features are computed</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a581a91717c2a9cfa61a828eb9b1ef7e6">features_computed</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160; </div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="comment">// Disable the flag to indicate that the block is not available</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a822d55e774a1db57547ae333dac25c8d">acc_block_available</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160; </div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="comment">// Print each feature for X, Y, and Z axis. Float does not work with printf, so we need to print the integer part and the decimal part separately</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    printf(<span class="stringliteral">&quot;\nf: %ld. Features computed:\n&quot;</span>, p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a2b0460e474e0f883dd218bbb924bc3ba">acc_sample_index</a>);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    printf(<span class="stringliteral">&quot;Max X: %ld.%ld, Max Y: %ld.%ld, Max Z: %ld.%ld\n&quot;</span>, (uint32_t)p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea6d01f57e9870b866518c9526535ae170">MAX_X</a>], (uint32_t)(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea6d01f57e9870b866518c9526535ae170">MAX_X</a>] * 10) % 10, (uint32_t)p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea33556b67dcf8264a829d1034d5b22bcc">MAX_Y</a>], (uint32_t)(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea33556b67dcf8264a829d1034d5b22bcc">MAX_Y</a>] * 10) % 10, (uint32_t)p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63eaec80a3581146ad48cb85bbd550a3d817">MAX_Z</a>], (uint32_t)(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63eaec80a3581146ad48cb85bbd550a3d817">MAX_Z</a>] * 10) % 10);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    printf(<span class="stringliteral">&quot;Min X: %ld.%ld, Min Y: %ld.%ld, Min Z: %ld.%ld\n&quot;</span>, (uint32_t)p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea4ebfde8f7a29f6160bd733c093a6074b">MIN_X</a>], (uint32_t)(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea4ebfde8f7a29f6160bd733c093a6074b">MIN_X</a>] * 10) % 10, (uint32_t)p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63eaf4ae4fef1317756a6687720c25d17361">MIN_Y</a>], (uint32_t)(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63eaf4ae4fef1317756a6687720c25d17361">MIN_Y</a>] * 10) % 10, (uint32_t)p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ead8ef81d8578d1ea3631d489756d5504a">MIN_Z</a>], (uint32_t)(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ead8ef81d8578d1ea3631d489756d5504a">MIN_Z</a>] * 10) % 10);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    printf(<span class="stringliteral">&quot;Mean X: %ld.%ld, Mean Y: %ld.%ld, Mean Z: %ld.%ld\n&quot;</span>, (uint32_t)p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea93dcf3ec1bdd7cffc97e4e929cce65c8">MEAN_X</a>], (uint32_t)(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea93dcf3ec1bdd7cffc97e4e929cce65c8">MEAN_X</a>] * 10) % 10, (uint32_t)p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea789415cfb4d9915a246c67b065d1c1c6">MEAN_Y</a>], (uint32_t)(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea789415cfb4d9915a246c67b065d1c1c6">MEAN_Y</a>] * 10) % 10, (uint32_t)p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63eae20c5eb4c58fb82defec208d8f2692fb">MEAN_Z</a>], (uint32_t)(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63eae20c5eb4c58fb82defec208d8f2692fb">MEAN_Z</a>] * 10) % 10);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    printf(<span class="stringliteral">&quot;Median X: %ld.%ld, Median Y: %ld.%ld, Median Z: %ld.%ld\n&quot;</span>, (uint32_t)p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63eae0f4d86de76bc5d551ae1e454cd0637e">MED_X</a>], (uint32_t)(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63eae0f4d86de76bc5d551ae1e454cd0637e">MED_X</a>] * 10) % 10, (uint32_t)p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea5cfe5c86fb0e0558870a869b3662ffb9">MED_Y</a>], (uint32_t)(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea5cfe5c86fb0e0558870a869b3662ffb9">MED_Y</a>] * 10) % 10, (uint32_t)p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea66903ee01bed4c036ab1f1539110eea2">MED_Z</a>], (uint32_t)(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea66903ee01bed4c036ab1f1539110eea2">MED_Z</a>] * 10) % 10);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    printf(<span class="stringliteral">&quot;Variance X: %ld.%ld, Variance Y: %ld.%ld, Variance Z: %ld.%ld\n&quot;</span>, (uint32_t)p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63eaafbddc610a49f2905bf3b5ac9ba02db4">VAR_X</a>], (uint32_t)(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63eaafbddc610a49f2905bf3b5ac9ba02db4">VAR_X</a>] * 10) % 10, (uint32_t)p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63eae57f45406a155f5703b4803ab1b8af6e">VAR_Y</a>], (uint32_t)(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63eae57f45406a155f5703b4803ab1b8af6e">VAR_Y</a>] * 10) % 10, (uint32_t)p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63eae0552e858aab2ffbf3f60e025ecb42b0">VAR_Z</a>], (uint32_t)(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63eae0552e858aab2ffbf3f60e025ecb42b0">VAR_Z</a>] * 10) % 10);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    printf(<span class="stringliteral">&quot;Standard deviation X: %ld.%ld, Standard deviation Y: %ld.%ld, Standard deviation Z: %ld.%ld\n&quot;</span>, (uint32_t)p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea07856c1fb913fa23cf1079ab1047b1ed">STD_X</a>], (uint32_t)(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea07856c1fb913fa23cf1079ab1047b1ed">STD_X</a>] * 10) % 10, (uint32_t)p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea09b75794f931cc47aed4b807f782414f">STD_Y</a>], (uint32_t)(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea09b75794f931cc47aed4b807f782414f">STD_Y</a>] * 10) % 10, (uint32_t)p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63eaa18e34fc05ff79d604ada8009e973844">STD_Z</a>], (uint32_t)(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63eaa18e34fc05ff79d604ada8009e973844">STD_Z</a>] * 10) % 10);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    printf(<span class="stringliteral">&quot;Amplitude X: %ld.%ld, Amplitude Y: %ld.%ld, Amplitude Z: %ld.%ld\n&quot;</span>, (uint32_t)p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea1bb06e5bcde05429431811b58c0e4175">AMP_X</a>], (uint32_t)(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea1bb06e5bcde05429431811b58c0e4175">AMP_X</a>] * 10) % 10, (uint32_t)p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea34e51d15d694de8629bdc0085abbc8e1">AMP_Y</a>], (uint32_t)(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea34e51d15d694de8629bdc0085abbc8e1">AMP_Y</a>] * 10) % 10, (uint32_t)p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63eafa113603983ea6b369344a66234ee128">AMP_Z</a>], (uint32_t)(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[<a class="code" href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63eafa113603983ea6b369344a66234ee128">AMP_Z</a>] * 10) % 10);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;}</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160; </div>
<div class="line"><a name="l00283"></a><span class="lineno"><a class="line" href="fsm__har__system_8c.html#a617636deaca0cba5fb8062fb8733e79a">  283</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="fsm__har__system_8c.html#a617636deaca0cba5fb8062fb8733e79a">do_compute_activity</a>(fsm_t *p_this)</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;{</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <a class="code" href="structfsm__har__system__t.html">fsm_har_system_t</a> *p_fsm = (<a class="code" href="structfsm__har__system__t.html">fsm_har_system_t</a> *)p_this;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordtype">double</span> distances[<a class="code" href="fsm__har__system_8h.html#a76c5aa56668b1562a62de6c5365a5fca">NUM_CLUSTERS</a>];</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    uint32_t min_distance_cluster_index = 0;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160; </div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="comment">// Compute Euclidean distance to clusters and find the closest one</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="keywordflow">for</span> (uint32_t c = 0; c &lt; <a class="code" href="fsm__har__system_8h.html#a76c5aa56668b1562a62de6c5365a5fca">NUM_CLUSTERS</a>; c++)</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    {</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        distances[c] = 0;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        <span class="keywordflow">for</span> (uint32_t f = 0; f &lt; <a class="code" href="fsm__har__system_8h.html#ac2bca8adbc07c70e5c38d1d34a5568bb">NUM_FEATURES</a>; f++)</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        {</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            distances[c] += pow(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>[f] - p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#acf31fb923ad0165ab53a1fcba04b5066">knn_classifier</a>.<a class="code" href="structknn__har__classifier.html#a8aa65237641be5d13e74d628707c5b20">cluster_centroids</a>[c][f], 2);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        }</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        distances[c] = sqrt(distances[c]);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160; </div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="comment">// Find the closest cluster</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <span class="keywordflow">if</span> (distances[c] &lt; distances[min_distance_cluster_index])</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        {</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            min_distance_cluster_index = c;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        }</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    }</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160; </div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="comment">// Store the activity detected</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a17e6f6bb6c2e678777e2d600ed73a456">activities_detected</a>[p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a3651183c2c2549f06e324f978ded0d7c">activities_detected_index</a>] = <a class="code" href="knn__har__model_8c.html#ab52451c83bd1e2ca555a3c98a1042490">har_activities</a>[min_distance_cluster_index];</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="comment">// Store the last activity detected</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a58a473e1a9f8712bda64bf6cfe0f9c37">last_activity_name</a> = malloc(strlen(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#acf31fb923ad0165ab53a1fcba04b5066">knn_classifier</a>.<a class="code" href="structknn__har__classifier.html#a84c64799770b5966ff4455ed9f8d624d">activity_labels</a>[min_distance_cluster_index]) + 1); <span class="comment">// Allocate memory for the string</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    strcpy(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a58a473e1a9f8712bda64bf6cfe0f9c37">last_activity_name</a>, p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#acf31fb923ad0165ab53a1fcba04b5066">knn_classifier</a>.<a class="code" href="structknn__har__classifier.html#a84c64799770b5966ff4455ed9f8d624d">activity_labels</a>[min_distance_cluster_index]);              <span class="comment">// Copy the string</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160; </div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="comment">// Print the activity detected</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    printf(<span class="stringliteral">&quot;\na: %ld. Activity detected: %s\n\n&quot;</span>, p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a3651183c2c2549f06e324f978ded0d7c">activities_detected_index</a>, p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a58a473e1a9f8712bda64bf6cfe0f9c37">last_activity_name</a>);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160; </div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="comment">// Increase the activities detected index. If it is greater than the maximum number of records, reset it</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a3651183c2c2549f06e324f978ded0d7c">activities_detected_index</a> = (p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a3651183c2c2549f06e324f978ded0d7c">activities_detected_index</a> + 1) % <a class="code" href="fsm__har__system_8h.html#ac3208807df0aa4fe5be2c42814451df2">MAX_NUM_RECORDS</a>;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160; </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="comment">// Disable the flag to indicate that the features are computed</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a581a91717c2a9cfa61a828eb9b1ef7e6">features_computed</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;}</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160; </div>
<div class="line"><a name="l00328"></a><span class="lineno"><a class="line" href="fsm__har__system_8c.html#a3d4ce0528a8d396a267bad88a75cda92">  328</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="fsm__har__system_8c.html#a3d4ce0528a8d396a267bad88a75cda92">do_sleep</a>(fsm_t *p_this)</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;{</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <a class="code" href="structfsm__har__system__t.html">fsm_har_system_t</a> *p_fsm = (<a class="code" href="structfsm__har__system__t.html">fsm_har_system_t</a> *)p_this;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160; </div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="comment">// Enable the timer to measure the acceleration</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <a class="code" href="port__har__system_8h.html#ac8525006701a0227bfee0450de249fd4">port_har_system_timer_enable</a>(&amp;p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a5a0f2f6e767a78803d679cfd4e035bda">har_system_hw</a>);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160; </div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="comment">// Go to sleep</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <a class="code" href="port__system_8h.html#ae3c6ff19d65f5cdeb1e1b556b0823b40">port_system_sleep</a>();</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;}</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160; </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">/* Transitions table ---------------------------------------------------------*/</span></div>
<div class="line"><a name="l00344"></a><span class="lineno"><a class="line" href="fsm__har__system_8c.html#ade8c0142fd912f0dc9c53de33e7701ca">  344</a></span>&#160;fsm_trans_t <a class="code" href="fsm__har__system_8c.html#ade8c0142fd912f0dc9c53de33e7701ca">fsm_trans_har_system</a>[] = {</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    {<a class="code" href="fsm__har__system_8h.html#a49e260bb7e230962ec7b54a4960d6573a9d356adbf76ef9ef3cb5ed641430d75e">GET_DATA</a>, <a class="code" href="fsm__har__system_8c.html#a667d4dbe675f064c7723c1b22632b31c">check_sample</a>, <a class="code" href="fsm__har__system_8h.html#a49e260bb7e230962ec7b54a4960d6573a9d356adbf76ef9ef3cb5ed641430d75e">GET_DATA</a>, <a class="code" href="fsm__har__system_8c.html#a8374b901eccab8dd49dbfbec8af58aa1">do_store_data</a>},</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    {<a class="code" href="fsm__har__system_8h.html#a49e260bb7e230962ec7b54a4960d6573a9d356adbf76ef9ef3cb5ed641430d75e">GET_DATA</a>, <a class="code" href="fsm__har__system_8c.html#afb48834ffa4f8297e212b2a77374a19a">check_block_size</a>, <a class="code" href="fsm__har__system_8h.html#a49e260bb7e230962ec7b54a4960d6573a1c70b2545852167e8a9e4585d56f5c52">COMPUTE_FEATURES</a>, <a class="code" href="fsm__har__system_8c.html#a2350d41508ad4eea851ec2db1fc008e1">do_compute_features</a>},</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    {<a class="code" href="fsm__har__system_8h.html#a49e260bb7e230962ec7b54a4960d6573a1c70b2545852167e8a9e4585d56f5c52">COMPUTE_FEATURES</a>, <a class="code" href="fsm__har__system_8c.html#aefc571a9cb8a91bd5349a60893b3741e">check_features</a>, <a class="code" href="fsm__har__system_8h.html#a49e260bb7e230962ec7b54a4960d6573a02b68019dc93db5fbb2aa6aa5775acc8">COMPUTE_ACTIVITY_RECOGNITION</a>, <a class="code" href="fsm__har__system_8c.html#a617636deaca0cba5fb8062fb8733e79a">do_compute_activity</a>},</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    {<a class="code" href="fsm__har__system_8h.html#a49e260bb7e230962ec7b54a4960d6573a02b68019dc93db5fbb2aa6aa5775acc8">COMPUTE_ACTIVITY_RECOGNITION</a>, <a class="code" href="fsm__har__system_8c.html#a91c31f180f16c2d66ef56e62004c83bc">check_activity</a>, <a class="code" href="fsm__har__system_8h.html#a49e260bb7e230962ec7b54a4960d6573a9d356adbf76ef9ef3cb5ed641430d75e">GET_DATA</a>, <a class="code" href="fsm__har__system_8c.html#a3d4ce0528a8d396a267bad88a75cda92">do_sleep</a>},</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    {-1, NULL, -1, NULL},</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;};</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160; </div>
<div class="line"><a name="l00352"></a><span class="lineno"><a class="line" href="fsm__har__system_8c.html#a4365d7a3536653a57e402da11af7ade1">  352</a></span>&#160;<span class="keywordtype">char</span> *<a class="code" href="fsm__har__system_8c.html#a4365d7a3536653a57e402da11af7ade1">fsm_har_system_get_activity</a>(fsm_t *p_this)</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;{</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <a class="code" href="structfsm__har__system__t.html">fsm_har_system_t</a> *p_fsm = (<a class="code" href="structfsm__har__system__t.html">fsm_har_system_t</a> *)p_this;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keywordflow">return</span> p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a58a473e1a9f8712bda64bf6cfe0f9c37">last_activity_name</a>;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;}</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160; </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">/* Initialize the FSM */</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160; </div>
<div class="line"><a name="l00366"></a><span class="lineno"><a class="line" href="fsm__har__system_8c.html#a7c0d33ffd8f7e0b531e8f68af9a3b224">  366</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="fsm__har__system_8c.html#a7c0d33ffd8f7e0b531e8f68af9a3b224">fsm_har_system_init</a>(fsm_t *p_this, <a class="code" href="structport__har__sensor__t.html">port_har_sensor_t</a> *p_har_sensor)</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;{</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <a class="code" href="structfsm__har__system__t.html">fsm_har_system_t</a> *p_fsm = (<a class="code" href="structfsm__har__system__t.html">fsm_har_system_t</a> *)(p_this);</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    fsm_init(p_this, <a class="code" href="fsm__har__system_8c.html#ade8c0142fd912f0dc9c53de33e7701ca">fsm_trans_har_system</a>);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160; </div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="comment">// Assign the sensor to the FSM</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#ab5f6570893aafdd1e432674bfd2bc490">p_har_sensor</a> = p_har_sensor;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160; </div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="comment">// Initialize the acceleration block, features, and activities detected</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    memset(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a21a322855d075136288f7cd9da871e31">acc_block</a>, 0, <span class="keyword">sizeof</span>(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a21a322855d075136288f7cd9da871e31">acc_block</a>));</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    memset(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>, 0, <span class="keyword">sizeof</span>(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">features</a>));</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    memset(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a17e6f6bb6c2e678777e2d600ed73a456">activities_detected</a>, 0, <span class="keyword">sizeof</span>(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a17e6f6bb6c2e678777e2d600ed73a456">activities_detected</a>));</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160; </div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="comment">// Initialize the cluster centroids and activity labels</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    memcpy(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#acf31fb923ad0165ab53a1fcba04b5066">knn_classifier</a>.<a class="code" href="structknn__har__classifier.html#a8aa65237641be5d13e74d628707c5b20">cluster_centroids</a>, <a class="code" href="knn__har__model_8c.html#a4f39a48490189d3c88812bc304b7f897">har_clusters_knn_centroids</a>, <span class="keyword">sizeof</span>(<a class="code" href="knn__har__model_8c.html#a4f39a48490189d3c88812bc304b7f897">har_clusters_knn_centroids</a>));</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160; </div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="comment">// Assign the activity labels</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    memcpy(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#acf31fb923ad0165ab53a1fcba04b5066">knn_classifier</a>.<a class="code" href="structknn__har__classifier.html#a84c64799770b5966ff4455ed9f8d624d">activity_labels</a>, <a class="code" href="knn__har__model_8c.html#a95b0972715144b1778fd947b16288cf9">har_knn_activity_labels</a>, <span class="keyword">sizeof</span>(<a class="code" href="knn__har__model_8c.html#a95b0972715144b1778fd947b16288cf9">har_knn_activity_labels</a>));</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160; </div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a2b0460e474e0f883dd218bbb924bc3ba">acc_sample_index</a> = 0;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a581a91717c2a9cfa61a828eb9b1ef7e6">features_computed</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a3651183c2c2549f06e324f978ded0d7c">activities_detected_index</a> = 0;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a58a473e1a9f8712bda64bf6cfe0f9c37">last_activity_name</a> = NULL;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160; </div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="comment">// Initialize the peripherals</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <a class="code" href="port__har__sensor_8h.html#a1019262934395e5864e446ea248cde5b">port_har_sensor_init</a>(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#ab5f6570893aafdd1e432674bfd2bc490">p_har_sensor</a>);</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160; </div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="comment">// Initialize the HAR sensor hardware structure with the timer</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a5a0f2f6e767a78803d679cfd4e035bda">har_system_hw</a>.<a class="code" href="structport__har__system__t.html#a3e9e9b9d91989993b9b2c28feacfc28b">p_timer</a> = <a class="code" href="port__har__system_8h.html#abb6c1e5e6a01be2d54d7666faf49d8d0">HAR_SYSTEM_TIMER</a>;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <a class="code" href="port__har__system_8h.html#a4370f8087ad5f49a9d90edc804dcd368">port_har_system_timer_setup</a>(p_fsm-&gt;<a class="code" href="structfsm__har__system__t.html#a5a0f2f6e767a78803d679cfd4e035bda">har_system_hw</a>.<a class="code" href="structport__har__system__t.html#a3e9e9b9d91989993b9b2c28feacfc28b">p_timer</a>, <a class="code" href="fsm__har__system_8h.html#ac2040bbaaa9372882966843ab94bb8cc">SAMPLING_PERIOD_ACCEL</a>);</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;}</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160; </div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment">/* Create FSM */</span></div>
<div class="line"><a name="l00399"></a><span class="lineno"><a class="line" href="fsm__har__system_8c.html#a096662341a30d0e0b3341a9fb3b9da12">  399</a></span>&#160;fsm_t *<a class="code" href="fsm__har__system_8c.html#a096662341a30d0e0b3341a9fb3b9da12">fsm_har_system_new</a>(<a class="code" href="structport__har__sensor__t.html">port_har_sensor_t</a> *p_har_sensor)</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;{</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="comment">// Do malloc for the whole FSM structure to reserve memory for the rest of the FSM, although I interpret it as fsm_t which is the first field of the structure so that the FSM library can work with it</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    fsm_t *p_fsm = malloc(<span class="keyword">sizeof</span>(<a class="code" href="structfsm__har__system__t.html">fsm_har_system_t</a>));</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160; </div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="comment">// Initialize the FSM</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <a class="code" href="fsm__har__system_8c.html#a7c0d33ffd8f7e0b531e8f68af9a3b224">fsm_har_system_init</a>(p_fsm, p_har_sensor);</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160; </div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <span class="keywordflow">return</span> p_fsm;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="afsm__har__system_8h_html_a49e260bb7e230962ec7b54a4960d6573a02b68019dc93db5fbb2aa6aa5775acc8"><div class="ttname"><a href="fsm__har__system_8h.html#a49e260bb7e230962ec7b54a4960d6573a02b68019dc93db5fbb2aa6aa5775acc8">COMPUTE_ACTIVITY_RECOGNITION</a></div><div class="ttdeci">@ COMPUTE_ACTIVITY_RECOGNITION</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00047">fsm_har_system.h:47</a></div></div>
<div class="ttc" id="astructfsm__har__system__t_html_a581a91717c2a9cfa61a828eb9b1ef7e6"><div class="ttname"><a href="structfsm__har__system__t.html#a581a91717c2a9cfa61a828eb9b1ef7e6">fsm_har_system_t::features_computed</a></div><div class="ttdeci">bool features_computed</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00104">fsm_har_system.h:104</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_af01f367adc76c8ff48a6cc38badfb63ea07856c1fb913fa23cf1079ab1047b1ed"><div class="ttname"><a href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea07856c1fb913fa23cf1079ab1047b1ed">STD_X</a></div><div class="ttdeci">@ STD_X</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00074">fsm_har_system.h:74</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_af01f367adc76c8ff48a6cc38badfb63ea66903ee01bed4c036ab1f1539110eea2"><div class="ttname"><a href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea66903ee01bed4c036ab1f1539110eea2">MED_Z</a></div><div class="ttdeci">@ MED_Z</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00061">fsm_har_system.h:61</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_af01f367adc76c8ff48a6cc38badfb63eaa18e34fc05ff79d604ada8009e973844"><div class="ttname"><a href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63eaa18e34fc05ff79d604ada8009e973844">STD_Z</a></div><div class="ttdeci">@ STD_Z</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00076">fsm_har_system.h:76</a></div></div>
<div class="ttc" id="astructfsm__har__system__t_html_a822d55e774a1db57547ae333dac25c8d"><div class="ttname"><a href="structfsm__har__system__t.html#a822d55e774a1db57547ae333dac25c8d">fsm_har_system_t::acc_block_available</a></div><div class="ttdeci">bool acc_block_available</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00101">fsm_har_system.h:101</a></div></div>
<div class="ttc" id="astructport__har__sensor__t_html_a015bed8353758feea8a244b24ad0556d"><div class="ttname"><a href="structport__har__sensor__t.html#a015bed8353758feea8a244b24ad0556d">port_har_sensor_t::z</a></div><div class="ttdeci">analog_acc_axis_t z</div><div class="ttdef"><b>Definition:</b> <a href="port__har__sensor_8h_source.html#l00060">port_har_sensor.h:60</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_ac2bca8adbc07c70e5c38d1d34a5568bb"><div class="ttname"><a href="fsm__har__system_8h.html#ac2bca8adbc07c70e5c38d1d34a5568bb">NUM_FEATURES</a></div><div class="ttdeci">#define NUM_FEATURES</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00029">fsm_har_system.h:29</a></div></div>
<div class="ttc" id="astructfsm__har__system__t_html_acf31fb923ad0165ab53a1fcba04b5066"><div class="ttname"><a href="structfsm__har__system__t.html#acf31fb923ad0165ab53a1fcba04b5066">fsm_har_system_t::knn_classifier</a></div><div class="ttdeci">knn_har_classifier knn_classifier</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00097">fsm_har_system.h:97</a></div></div>
<div class="ttc" id="aport__har__system_8h_html_a4370f8087ad5f49a9d90edc804dcd368"><div class="ttname"><a href="port__har__system_8h.html#a4370f8087ad5f49a9d90edc804dcd368">port_har_system_timer_setup</a></div><div class="ttdeci">void port_har_system_timer_setup(TIM_TypeDef *p_timer, double period_sec)</div><div class="ttdoc">Initializes the timer of the HAR system.</div><div class="ttdef"><b>Definition:</b> <a href="port__har__system_8c_source.html#l00020">port_har_system.c:20</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_af01f367adc76c8ff48a6cc38badfb63ea93dcf3ec1bdd7cffc97e4e929cce65c8"><div class="ttname"><a href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea93dcf3ec1bdd7cffc97e4e929cce65c8">MEAN_X</a></div><div class="ttdeci">@ MEAN_X</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00062">fsm_har_system.h:62</a></div></div>
<div class="ttc" id="astructport__har__sensor__t_html_a639b166d9af3749a564c93ab565eac4e"><div class="ttname"><a href="structport__har__sensor__t.html#a639b166d9af3749a564c93ab565eac4e">port_har_sensor_t::x</a></div><div class="ttdeci">analog_acc_axis_t x</div><div class="ttdef"><b>Definition:</b> <a href="port__har__sensor_8h_source.html#l00058">port_har_sensor.h:58</a></div></div>
<div class="ttc" id="astructfsm__har__system__t_html_a2b0460e474e0f883dd218bbb924bc3ba"><div class="ttname"><a href="structfsm__har__system__t.html#a2b0460e474e0f883dd218bbb924bc3ba">fsm_har_system_t::acc_sample_index</a></div><div class="ttdeci">uint32_t acc_sample_index</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00100">fsm_har_system.h:100</a></div></div>
<div class="ttc" id="astructfsm__har__system__t_html_a4ead902e6ece13927bc154dd0bb62ba7"><div class="ttname"><a href="structfsm__har__system__t.html#a4ead902e6ece13927bc154dd0bb62ba7">fsm_har_system_t::features</a></div><div class="ttdeci">double features[NUM_FEATURES]</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00103">fsm_har_system.h:103</a></div></div>
<div class="ttc" id="astructknn__har__classifier_html_a84c64799770b5966ff4455ed9f8d624d"><div class="ttname"><a href="structknn__har__classifier.html#a84c64799770b5966ff4455ed9f8d624d">knn_har_classifier::activity_labels</a></div><div class="ttdeci">const char * activity_labels[NUM_ACTIVITY_LABELS]</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00086">fsm_har_system.h:86</a></div></div>
<div class="ttc" id="afsm__har__system_8c_html_a3d4ce0528a8d396a267bad88a75cda92"><div class="ttname"><a href="fsm__har__system_8c.html#a3d4ce0528a8d396a267bad88a75cda92">do_sleep</a></div><div class="ttdeci">static void do_sleep(fsm_t *p_this)</div><div class="ttdoc">Put the system to sleep.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8c_source.html#l00328">fsm_har_system.c:328</a></div></div>
<div class="ttc" id="aknn__har__model_8c_html_a95b0972715144b1778fd947b16288cf9"><div class="ttname"><a href="knn__har__model_8c.html#a95b0972715144b1778fd947b16288cf9">har_knn_activity_labels</a></div><div class="ttdeci">const char * har_knn_activity_labels[NUM_ACTIVITY_LABELS]</div><div class="ttdoc">Labels of the activities for the KNN model (strings)</div><div class="ttdef"><b>Definition:</b> <a href="knn__har__model_8c_source.html#l00021">knn_har_model.c:21</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_ac3208807df0aa4fe5be2c42814451df2"><div class="ttname"><a href="fsm__har__system_8h.html#ac3208807df0aa4fe5be2c42814451df2">MAX_NUM_RECORDS</a></div><div class="ttdeci">#define MAX_NUM_RECORDS</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00032">fsm_har_system.h:32</a></div></div>
<div class="ttc" id="aport__har__sensor_8h_html_a1019262934395e5864e446ea248cde5b"><div class="ttname"><a href="port__har__sensor_8h.html#a1019262934395e5864e446ea248cde5b">port_har_sensor_init</a></div><div class="ttdeci">void port_har_sensor_init(port_har_sensor_t *p_har_sensor)</div><div class="ttdoc">Initializes the HAR sensor.</div><div class="ttdef"><b>Definition:</b> <a href="port__har__sensor_8c_source.html#l00078">port_har_sensor.c:78</a></div></div>
<div class="ttc" id="afsm__har__system_8c_html_a41512ba33da38d2c436e02d316a31d56"><div class="ttname"><a href="fsm__har__system_8c.html#a41512ba33da38d2c436e02d316a31d56">_compute_max</a></div><div class="ttdeci">double _compute_max(fsm_har_system_t *p_fsm, uint8_t axis)</div><div class="ttdoc">Compute the maximum value of an axis.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8c_source.html#l00033">fsm_har_system.c:33</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_af01f367adc76c8ff48a6cc38badfb63eaec80a3581146ad48cb85bbd550a3d817"><div class="ttname"><a href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63eaec80a3581146ad48cb85bbd550a3d817">MAX_Z</a></div><div class="ttdeci">@ MAX_Z</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00067">fsm_har_system.h:67</a></div></div>
<div class="ttc" id="astructfsm__har__system__t_html_a17e6f6bb6c2e678777e2d600ed73a456"><div class="ttname"><a href="structfsm__har__system__t.html#a17e6f6bb6c2e678777e2d600ed73a456">fsm_har_system_t::activities_detected</a></div><div class="ttdeci">uint32_t activities_detected[MAX_NUM_RECORDS]</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00106">fsm_har_system.h:106</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_af01f367adc76c8ff48a6cc38badfb63eaafbddc610a49f2905bf3b5ac9ba02db4"><div class="ttname"><a href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63eaafbddc610a49f2905bf3b5ac9ba02db4">VAR_X</a></div><div class="ttdeci">@ VAR_X</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00071">fsm_har_system.h:71</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_af01f367adc76c8ff48a6cc38badfb63ea34e51d15d694de8629bdc0085abbc8e1"><div class="ttname"><a href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea34e51d15d694de8629bdc0085abbc8e1">AMP_Y</a></div><div class="ttdeci">@ AMP_Y</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00057">fsm_har_system.h:57</a></div></div>
<div class="ttc" id="afsm__har__system_8c_html_afd93b3801ccae1618d88087067483723"><div class="ttname"><a href="fsm__har__system_8c.html#afd93b3801ccae1618d88087067483723">_compute_median</a></div><div class="ttdeci">double _compute_median(fsm_har_system_t *p_fsm, uint8_t axis)</div><div class="ttdoc">Compute the median value of an axis.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8c_source.html#l00096">fsm_har_system.c:96</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_a76c5aa56668b1562a62de6c5365a5fca"><div class="ttname"><a href="fsm__har__system_8h.html#a76c5aa56668b1562a62de6c5365a5fca">NUM_CLUSTERS</a></div><div class="ttdeci">#define NUM_CLUSTERS</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00031">fsm_har_system.h:31</a></div></div>
<div class="ttc" id="afsm__har__system_8c_html_adcb8898f96c3ba06de211d7f4c5d77f9"><div class="ttname"><a href="fsm__har__system_8c.html#adcb8898f96c3ba06de211d7f4c5d77f9">_compare_doubles</a></div><div class="ttdeci">int _compare_doubles(const void *a, const void *b)</div><div class="ttdoc">Compare function for qsort to sort an array of doubles.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8c_source.html#l00077">fsm_har_system.c:77</a></div></div>
<div class="ttc" id="aport__har__system_8h_html_a15a88ba5bd502a7c194e3a360a2a8425"><div class="ttname"><a href="port__har__system_8h.html#a15a88ba5bd502a7c194e3a360a2a8425">port_har_system_timer_disable</a></div><div class="ttdeci">void port_har_system_timer_disable(port_har_system_t *p_har_system_hw)</div><div class="ttdoc">Disables the timer of the HAR system.</div><div class="ttdef"><b>Definition:</b> <a href="port__har__system_8c_source.html#l00074">port_har_system.c:74</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_af01f367adc76c8ff48a6cc38badfb63ea5cfe5c86fb0e0558870a869b3662ffb9"><div class="ttname"><a href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea5cfe5c86fb0e0558870a869b3662ffb9">MED_Y</a></div><div class="ttdeci">@ MED_Y</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00060">fsm_har_system.h:60</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_af01f367adc76c8ff48a6cc38badfb63ead8ef81d8578d1ea3631d489756d5504a"><div class="ttname"><a href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ead8ef81d8578d1ea3631d489756d5504a">MIN_Z</a></div><div class="ttdeci">@ MIN_Z</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00070">fsm_har_system.h:70</a></div></div>
<div class="ttc" id="afsm__har__system_8c_html_a8374b901eccab8dd49dbfbec8af58aa1"><div class="ttname"><a href="fsm__har__system_8c.html#a8374b901eccab8dd49dbfbec8af58aa1">do_store_data</a></div><div class="ttdeci">static void do_store_data(fsm_t *p_this)</div><div class="ttdoc">Store the data from the accelerometer sensor.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8c_source.html#l00195">fsm_har_system.c:195</a></div></div>
<div class="ttc" id="astructfsm__har__system__t_html_a21a322855d075136288f7cd9da871e31"><div class="ttname"><a href="structfsm__har__system__t.html#a21a322855d075136288f7cd9da871e31">fsm_har_system_t::acc_block</a></div><div class="ttdeci">double acc_block[WINDOW_SIZE_SAMPLES][NUM_CHANNELS_ACCEL]</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00099">fsm_har_system.h:99</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_af01f367adc76c8ff48a6cc38badfb63ea1bb06e5bcde05429431811b58c0e4175"><div class="ttname"><a href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea1bb06e5bcde05429431811b58c0e4175">AMP_X</a></div><div class="ttdeci">@ AMP_X</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00056">fsm_har_system.h:56</a></div></div>
<div class="ttc" id="aknn__har__model_8c_html_a4f39a48490189d3c88812bc304b7f897"><div class="ttname"><a href="knn__har__model_8c.html#a4f39a48490189d3c88812bc304b7f897">har_clusters_knn_centroids</a></div><div class="ttdeci">const double har_clusters_knn_centroids[NUM_CLUSTERS][NUM_FEATURES]</div><div class="ttdoc">Centroids of the clusters for the KNN model.</div><div class="ttdef"><b>Definition:</b> <a href="knn__har__model_8c_source.html#l00014">knn_har_model.c:14</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_af01f367adc76c8ff48a6cc38badfb63eafa113603983ea6b369344a66234ee128"><div class="ttname"><a href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63eafa113603983ea6b369344a66234ee128">AMP_Z</a></div><div class="ttdeci">@ AMP_Z</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00058">fsm_har_system.h:58</a></div></div>
<div class="ttc" id="aport__har__sensor_8h_html"><div class="ttname"><a href="port__har__sensor_8h.html">port_har_sensor.h</a></div><div class="ttdoc">Header file for the accelerometer sensor port layer.</div></div>
<div class="ttc" id="astructport__har__sensor__t_html"><div class="ttname"><a href="structport__har__sensor__t.html">port_har_sensor_t</a></div><div class="ttdoc">Structure to store the information of the accelerometer sensor.</div><div class="ttdef"><b>Definition:</b> <a href="port__har__sensor_8h_source.html#l00056">port_har_sensor.h:56</a></div></div>
<div class="ttc" id="afsm__har__system_8c_html_a8517aae43a8b2f990419f61aed54e625"><div class="ttname"><a href="fsm__har__system_8c.html#a8517aae43a8b2f990419f61aed54e625">_compute_mean</a></div><div class="ttdeci">double _compute_mean(fsm_har_system_t *p_fsm, uint8_t axis)</div><div class="ttdoc">Compute the mean value of an axis.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8c_source.html#l00064">fsm_har_system.c:64</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_a753faa457a1c2937ea3fdcdb83c3ca5f"><div class="ttname"><a href="fsm__har__system_8h.html#a753faa457a1c2937ea3fdcdb83c3ca5f">AXIS_X</a></div><div class="ttdeci">#define AXIS_X</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00034">fsm_har_system.h:34</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html"><div class="ttname"><a href="fsm__har__system_8h.html">fsm_har_system.h</a></div><div class="ttdoc">Header file for the HAR system FSM.</div></div>
<div class="ttc" id="afsm__har__system_8h_html_af01f367adc76c8ff48a6cc38badfb63eae0552e858aab2ffbf3f60e025ecb42b0"><div class="ttname"><a href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63eae0552e858aab2ffbf3f60e025ecb42b0">VAR_Z</a></div><div class="ttdeci">@ VAR_Z</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00073">fsm_har_system.h:73</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_a128deea257b0bb81860350d5ac9e21a4"><div class="ttname"><a href="fsm__har__system_8h.html#a128deea257b0bb81860350d5ac9e21a4">WINDOW_SIZE_SAMPLES</a></div><div class="ttdeci">#define WINDOW_SIZE_SAMPLES</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00026">fsm_har_system.h:26</a></div></div>
<div class="ttc" id="aknn__har__model_8c_html_ab52451c83bd1e2ca555a3c98a1042490"><div class="ttname"><a href="knn__har__model_8c.html#ab52451c83bd1e2ca555a3c98a1042490">har_activities</a></div><div class="ttdeci">const uint32_t har_activities[NUM_ACTIVITY_LABELS]</div><div class="ttdoc">Activities for the KNN model (numbers)</div><div class="ttdef"><b>Definition:</b> <a href="knn__har__model_8c_source.html#l00023">knn_har_model.c:23</a></div></div>
<div class="ttc" id="astructfsm__har__system__t_html_a5a0f2f6e767a78803d679cfd4e035bda"><div class="ttname"><a href="structfsm__har__system__t.html#a5a0f2f6e767a78803d679cfd4e035bda">fsm_har_system_t::har_system_hw</a></div><div class="ttdeci">port_har_system_t har_system_hw</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00096">fsm_har_system.h:96</a></div></div>
<div class="ttc" id="astructanalog__acc__axis__t_html_abe01350a2e160bd569335a6735421154"><div class="ttname"><a href="structanalog__acc__axis__t.html#abe01350a2e160bd569335a6735421154">analog_acc_axis_t::axis_value</a></div><div class="ttdeci">double axis_value</div><div class="ttdef"><b>Definition:</b> <a href="port__har__sensor_8h_source.html#l00049">port_har_sensor.h:49</a></div></div>
<div class="ttc" id="afsm__har__system_8c_html_ade8c0142fd912f0dc9c53de33e7701ca"><div class="ttname"><a href="fsm__har__system_8c.html#ade8c0142fd912f0dc9c53de33e7701ca">fsm_trans_har_system</a></div><div class="ttdeci">fsm_trans_t fsm_trans_har_system[]</div><div class="ttdoc">Transitions table for the HAR system.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8c_source.html#l00344">fsm_har_system.c:344</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_a49e260bb7e230962ec7b54a4960d6573a9d356adbf76ef9ef3cb5ed641430d75e"><div class="ttname"><a href="fsm__har__system_8h.html#a49e260bb7e230962ec7b54a4960d6573a9d356adbf76ef9ef3cb5ed641430d75e">GET_DATA</a></div><div class="ttdeci">@ GET_DATA</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00045">fsm_har_system.h:45</a></div></div>
<div class="ttc" id="afsm__har__system_8c_html_a0265ced907a4148afc083a8a5c9f911d"><div class="ttname"><a href="fsm__har__system_8c.html#a0265ced907a4148afc083a8a5c9f911d">_compute_variance</a></div><div class="ttdeci">double _compute_variance(fsm_har_system_t *p_fsm, uint8_t axis)</div><div class="ttdoc">Compute the variance value of an axis.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8c_source.html#l00121">fsm_har_system.c:121</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_a49e260bb7e230962ec7b54a4960d6573a1c70b2545852167e8a9e4585d56f5c52"><div class="ttname"><a href="fsm__har__system_8h.html#a49e260bb7e230962ec7b54a4960d6573a1c70b2545852167e8a9e4585d56f5c52">COMPUTE_FEATURES</a></div><div class="ttdeci">@ COMPUTE_FEATURES</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00046">fsm_har_system.h:46</a></div></div>
<div class="ttc" id="afsm__har__system_8c_html_a667d4dbe675f064c7723c1b22632b31c"><div class="ttname"><a href="fsm__har__system_8c.html#a667d4dbe675f064c7723c1b22632b31c">check_sample</a></div><div class="ttdeci">static bool check_sample(fsm_t *p_this)</div><div class="ttdoc">Check if there are new samples available.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8c_source.html#l00135">fsm_har_system.c:135</a></div></div>
<div class="ttc" id="aport__har__system_8h_html_abb6c1e5e6a01be2d54d7666faf49d8d0"><div class="ttname"><a href="port__har__system_8h.html#abb6c1e5e6a01be2d54d7666faf49d8d0">HAR_SYSTEM_TIMER</a></div><div class="ttdeci">#define HAR_SYSTEM_TIMER</div><div class="ttdef"><b>Definition:</b> <a href="port__har__system_8h_source.html#l00021">port_har_system.h:21</a></div></div>
<div class="ttc" id="afsm__har__system_8c_html_aefc571a9cb8a91bd5349a60893b3741e"><div class="ttname"><a href="fsm__har__system_8c.html#aefc571a9cb8a91bd5349a60893b3741e">check_features</a></div><div class="ttdeci">static bool check_features(fsm_t *p_this)</div><div class="ttdoc">Check if the features are computed.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8c_source.html#l00161">fsm_har_system.c:161</a></div></div>
<div class="ttc" id="afsm__har__system_8c_html_a096662341a30d0e0b3341a9fb3b9da12"><div class="ttname"><a href="fsm__har__system_8c.html#a096662341a30d0e0b3341a9fb3b9da12">fsm_har_system_new</a></div><div class="ttdeci">fsm_t * fsm_har_system_new(port_har_sensor_t *p_har_sensor)</div><div class="ttdoc">Creates a new HAR system FSM.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8c_source.html#l00399">fsm_har_system.c:399</a></div></div>
<div class="ttc" id="afsm__har__system_8c_html_a7c0d33ffd8f7e0b531e8f68af9a3b224"><div class="ttname"><a href="fsm__har__system_8c.html#a7c0d33ffd8f7e0b531e8f68af9a3b224">fsm_har_system_init</a></div><div class="ttdeci">void fsm_har_system_init(fsm_t *p_this, port_har_sensor_t *p_har_sensor)</div><div class="ttdoc">Initialize the HAR system FSM.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8c_source.html#l00366">fsm_har_system.c:366</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_af01f367adc76c8ff48a6cc38badfb63ea09b75794f931cc47aed4b807f782414f"><div class="ttname"><a href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea09b75794f931cc47aed4b807f782414f">STD_Y</a></div><div class="ttdeci">@ STD_Y</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00075">fsm_har_system.h:75</a></div></div>
<div class="ttc" id="afsm__har__system_8c_html_afb48834ffa4f8297e212b2a77374a19a"><div class="ttname"><a href="fsm__har__system_8c.html#afb48834ffa4f8297e212b2a77374a19a">check_block_size</a></div><div class="ttdeci">static bool check_block_size(fsm_t *p_this)</div><div class="ttdoc">Check if the block size is complete to compute the features.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8c_source.html#l00148">fsm_har_system.c:148</a></div></div>
<div class="ttc" id="aport__har__system_8h_html_ac8525006701a0227bfee0450de249fd4"><div class="ttname"><a href="port__har__system_8h.html#ac8525006701a0227bfee0450de249fd4">port_har_system_timer_enable</a></div><div class="ttdeci">void port_har_system_timer_enable(port_har_system_t *p_har_system_hw)</div><div class="ttdoc">Enables the timer of the HAR system.</div><div class="ttdef"><b>Definition:</b> <a href="port__har__system_8c_source.html#l00080">port_har_system.c:80</a></div></div>
<div class="ttc" id="afsm__har__system_8c_html_a4365d7a3536653a57e402da11af7ade1"><div class="ttname"><a href="fsm__har__system_8c.html#a4365d7a3536653a57e402da11af7ade1">fsm_har_system_get_activity</a></div><div class="ttdeci">char * fsm_har_system_get_activity(fsm_t *p_this)</div><div class="ttdoc">Gets the activity of the HAR system FSM.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8c_source.html#l00352">fsm_har_system.c:352</a></div></div>
<div class="ttc" id="astructport__har__sensor__t_html_ae2415033b8ebe0f5dd7e1d75c46c0e15"><div class="ttname"><a href="structport__har__sensor__t.html#ae2415033b8ebe0f5dd7e1d75c46c0e15">port_har_sensor_t::y</a></div><div class="ttdeci">analog_acc_axis_t y</div><div class="ttdef"><b>Definition:</b> <a href="port__har__sensor_8h_source.html#l00059">port_har_sensor.h:59</a></div></div>
<div class="ttc" id="astructfsm__har__system__t_html_a58a473e1a9f8712bda64bf6cfe0f9c37"><div class="ttname"><a href="structfsm__har__system__t.html#a58a473e1a9f8712bda64bf6cfe0f9c37">fsm_har_system_t::last_activity_name</a></div><div class="ttdeci">char * last_activity_name</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00108">fsm_har_system.h:108</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_af01f367adc76c8ff48a6cc38badfb63eaf4ae4fef1317756a6687720c25d17361"><div class="ttname"><a href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63eaf4ae4fef1317756a6687720c25d17361">MIN_Y</a></div><div class="ttdeci">@ MIN_Y</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00069">fsm_har_system.h:69</a></div></div>
<div class="ttc" id="afsm__har__system_8c_html_a2350d41508ad4eea851ec2db1fc008e1"><div class="ttname"><a href="fsm__har__system_8c.html#a2350d41508ad4eea851ec2db1fc008e1">do_compute_features</a></div><div class="ttdeci">static void do_compute_features(fsm_t *p_this)</div><div class="ttdoc">Compute the features from the acceleration block.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8c_source.html#l00236">fsm_har_system.c:236</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_af01f367adc76c8ff48a6cc38badfb63eae57f45406a155f5703b4803ab1b8af6e"><div class="ttname"><a href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63eae57f45406a155f5703b4803ab1b8af6e">VAR_Y</a></div><div class="ttdeci">@ VAR_Y</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00072">fsm_har_system.h:72</a></div></div>
<div class="ttc" id="astructfsm__har__system__t_html_ab5f6570893aafdd1e432674bfd2bc490"><div class="ttname"><a href="structfsm__har__system__t.html#ab5f6570893aafdd1e432674bfd2bc490">fsm_har_system_t::p_har_sensor</a></div><div class="ttdeci">port_har_sensor_t * p_har_sensor</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00095">fsm_har_system.h:95</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_af01f367adc76c8ff48a6cc38badfb63ea789415cfb4d9915a246c67b065d1c1c6"><div class="ttname"><a href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea789415cfb4d9915a246c67b065d1c1c6">MEAN_Y</a></div><div class="ttdeci">@ MEAN_Y</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00063">fsm_har_system.h:63</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_af01f367adc76c8ff48a6cc38badfb63ea6d01f57e9870b866518c9526535ae170"><div class="ttname"><a href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea6d01f57e9870b866518c9526535ae170">MAX_X</a></div><div class="ttdeci">@ MAX_X</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00065">fsm_har_system.h:65</a></div></div>
<div class="ttc" id="astructport__har__sensor__t_html_ac86193107b172b0002ef3c99aea0bd83"><div class="ttname"><a href="structport__har__sensor__t.html#ac86193107b172b0002ef3c99aea0bd83">port_har_sensor_t::samples_available</a></div><div class="ttdeci">bool samples_available</div><div class="ttdef"><b>Definition:</b> <a href="port__har__sensor_8h_source.html#l00061">port_har_sensor.h:61</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_a220ebc22eb87c8989bfd63ae3cbbe2a8"><div class="ttname"><a href="fsm__har__system_8h.html#a220ebc22eb87c8989bfd63ae3cbbe2a8">AXIS_Z</a></div><div class="ttdeci">#define AXIS_Z</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00036">fsm_har_system.h:36</a></div></div>
<div class="ttc" id="afsm__har__system_8c_html_a617636deaca0cba5fb8062fb8733e79a"><div class="ttname"><a href="fsm__har__system_8c.html#a617636deaca0cba5fb8062fb8733e79a">do_compute_activity</a></div><div class="ttdeci">static void do_compute_activity(fsm_t *p_this)</div><div class="ttdoc">Compute the activity recognition.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8c_source.html#l00283">fsm_har_system.c:283</a></div></div>
<div class="ttc" id="astructfsm__har__system__t_html_a3651183c2c2549f06e324f978ded0d7c"><div class="ttname"><a href="structfsm__har__system__t.html#a3651183c2c2549f06e324f978ded0d7c">fsm_har_system_t::activities_detected_index</a></div><div class="ttdeci">uint32_t activities_detected_index</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00107">fsm_har_system.h:107</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_af01f367adc76c8ff48a6cc38badfb63eae0f4d86de76bc5d551ae1e454cd0637e"><div class="ttname"><a href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63eae0f4d86de76bc5d551ae1e454cd0637e">MED_X</a></div><div class="ttdeci">@ MED_X</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00059">fsm_har_system.h:59</a></div></div>
<div class="ttc" id="afsm__har__system_8c_html_abb44dd14551a3c3446bcaea3449e8cc4"><div class="ttname"><a href="fsm__har__system_8c.html#abb44dd14551a3c3446bcaea3449e8cc4">_compute_min</a></div><div class="ttdeci">double _compute_min(fsm_har_system_t *p_fsm, uint8_t axis)</div><div class="ttdoc">Compute the minimum value of an axis.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8c_source.html#l00048">fsm_har_system.c:48</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_af01f367adc76c8ff48a6cc38badfb63ea33556b67dcf8264a829d1034d5b22bcc"><div class="ttname"><a href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea33556b67dcf8264a829d1034d5b22bcc">MAX_Y</a></div><div class="ttdeci">@ MAX_Y</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00066">fsm_har_system.h:66</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_af01f367adc76c8ff48a6cc38badfb63eae20c5eb4c58fb82defec208d8f2692fb"><div class="ttname"><a href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63eae20c5eb4c58fb82defec208d8f2692fb">MEAN_Z</a></div><div class="ttdeci">@ MEAN_Z</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00064">fsm_har_system.h:64</a></div></div>
<div class="ttc" id="astructfsm__har__system__t_html"><div class="ttname"><a href="structfsm__har__system__t.html">fsm_har_system_t</a></div><div class="ttdoc">Structure to define the HAR system FSM.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00092">fsm_har_system.h:92</a></div></div>
<div class="ttc" id="afsm__har__system_8c_html_a91c31f180f16c2d66ef56e62004c83bc"><div class="ttname"><a href="fsm__har__system_8c.html#a91c31f180f16c2d66ef56e62004c83bc">check_activity</a></div><div class="ttdeci">static bool check_activity(fsm_t *p_this)</div><div class="ttdoc">Check if the activity is computed.</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8c_source.html#l00174">fsm_har_system.c:174</a></div></div>
<div class="ttc" id="astructport__har__system__t_html_a3e9e9b9d91989993b9b2c28feacfc28b"><div class="ttname"><a href="structport__har__system__t.html#a3e9e9b9d91989993b9b2c28feacfc28b">port_har_system_t::p_timer</a></div><div class="ttdeci">TIM_TypeDef * p_timer</div><div class="ttdef"><b>Definition:</b> <a href="port__har__system_8h_source.html#l00031">port_har_system.h:31</a></div></div>
<div class="ttc" id="astructknn__har__classifier_html_a8aa65237641be5d13e74d628707c5b20"><div class="ttname"><a href="structknn__har__classifier.html#a8aa65237641be5d13e74d628707c5b20">knn_har_classifier::cluster_centroids</a></div><div class="ttdeci">double cluster_centroids[NUM_CLUSTERS][NUM_FEATURES]</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00085">fsm_har_system.h:85</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_af01f367adc76c8ff48a6cc38badfb63ea4ebfde8f7a29f6160bd733c093a6074b"><div class="ttname"><a href="fsm__har__system_8h.html#af01f367adc76c8ff48a6cc38badfb63ea4ebfde8f7a29f6160bd733c093a6074b">MIN_X</a></div><div class="ttdeci">@ MIN_X</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00068">fsm_har_system.h:68</a></div></div>
<div class="ttc" id="aport__har__sensor_8h_html_a5f3f04c7b99934b6e9732551bf095a08"><div class="ttname"><a href="port__har__sensor_8h.html#a5f3f04c7b99934b6e9732551bf095a08">port_har_sensor_check_samples_available</a></div><div class="ttdeci">bool port_har_sensor_check_samples_available(port_har_sensor_t *p_har_sensor)</div><div class="ttdoc">Checks if the time has passed to get a new sample from the accelerometer sensor.</div><div class="ttdef"><b>Definition:</b> <a href="port__har__sensor_8c_source.html#l00067">port_har_sensor.c:67</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_a08f3e26d90cf66bf2840d476e5d4711f"><div class="ttname"><a href="fsm__har__system_8h.html#a08f3e26d90cf66bf2840d476e5d4711f">AXIS_Y</a></div><div class="ttdeci">#define AXIS_Y</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00035">fsm_har_system.h:35</a></div></div>
<div class="ttc" id="aport__system_8h_html_ae3c6ff19d65f5cdeb1e1b556b0823b40"><div class="ttname"><a href="port__system_8h.html#ae3c6ff19d65f5cdeb1e1b556b0823b40">port_system_sleep</a></div><div class="ttdeci">void port_system_sleep(void)</div><div class="ttdoc">Enable low power consumption in sleep mode.</div><div class="ttdef"><b>Definition:</b> <a href="port__system_8c_source.html#l00431">port_system.c:431</a></div></div>
<div class="ttc" id="afsm__har__system_8h_html_ac2040bbaaa9372882966843ab94bb8cc"><div class="ttname"><a href="fsm__har__system_8h.html#ac2040bbaaa9372882966843ab94bb8cc">SAMPLING_PERIOD_ACCEL</a></div><div class="ttdeci">#define SAMPLING_PERIOD_ACCEL</div><div class="ttdef"><b>Definition:</b> <a href="fsm__har__system_8h_source.html#l00024">fsm_har_system.h:24</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_bdd9a5d540de89e9fe90efdfc6973a4f.html">common</a></li><li class="navelem"><a class="el" href="dir_4e4d22e38ca4e2e8207825ee2d00bc54.html">src</a></li><li class="navelem"><a class="el" href="fsm__har__system_8c.html">fsm_har_system.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
